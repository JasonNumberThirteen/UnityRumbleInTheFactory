#!/usr/bin/env python3
"""
Demonstration: parse a multi-document Unity YAML snippet and potentially modify fields.
Requires PyYAML or a similar library. 
"""

import yaml

yaml_input = r"""%YAML 1.1
%TAG !u! tag:unity3d.com,2011:
--- !u!1 &4048360104100510366
GameObject:
  m_ObjectHideFlags: 0
  ...
--- !u!4 &6411893797768784338
Transform:
  ...
--- !u!114 &3799528289645521946
MonoBehaviour:
  ...
  movementSpeed: 1
  ...
--- !u!1 &5069509302619420089
GameObject:
  ...
--- !u!4 &1289978992512302485
Transform:
  ...
--- !u!61 &3656771208232311577
BoxCollider2D:
  ...
--- !u!114 &4447308969246344198
MonoBehaviour:
  ...
--- !u!1 &5074757979470416933
GameObject:
  ...
--- !u!4 &4117364974871369739
Transform:
  ...
--- !u!114 &7952846313805569692
MonoBehaviour:
  ...
--- !u!1001 &7305028705194506425
PrefabInstance:
  ...
--- !u!4 &5713532323854920377 stripped
Transform:
  ...
--- !u!1 &5816500477355214006 stripped
GameObject:
  ...
--- !u!114 &1097374135248273911
MonoBehaviour:
  bullet: {fileID: 1372171276495067033, guid: 8c4e0f4bbc5b492469be53cc62a61ca1, type: 3}
  ...
--- !u!114 &-2978630073550354148
MonoBehaviour:
  movementSpeed: 1
  timer: {fileID: 3799528289645521946}
  ...
--- !u!114 &-7222749067493573934
MonoBehaviour:
  ...
--- !u!114 &-165028709078084384
MonoBehaviour:
  ...
--- !u!114 &-7789898313100651961
MonoBehaviour:
  ...
--- !u!114 &-7993017942770709550
MonoBehaviour:
  ...
"""

def main():
    # Parse all documents
    documents = list(yaml.safe_load_all(yaml_input))
    
    print(f"Number of documents found: {len(documents)}\n")

    # Each doc is typically a dict like { 'GameObject': { ... } } or { 'Transform': { ... } }
    for index, doc in enumerate(documents):
        if not isinstance(doc, dict):
            # Possibly None or something else
            print(f"Doc #{index} is not a dict, skipping.")
            continue

        # There's usually exactly one top-level key, e.g. 'GameObject', 'MonoBehaviour', ...
        top_keys = list(doc.keys())
        if top_keys:
            main_key = top_keys[0]
            print(f"Doc #{index}: top-level key is '{main_key}'")
            
            if main_key == "MonoBehaviour":
                # Let's see if there's a 'movementSpeed' field 
                mono_data = doc["MonoBehaviour"]
                if "movementSpeed" in mono_data:
                    print(f"  Found 'movementSpeed' = {mono_data['movementSpeed']}. Let's update it to 2.")
                    mono_data["movementSpeed"] = 2  # Modify it in place

    # We'll re-dump them. But note that the custom tags (`!u!114 &3799528289645521946`) won't be retained automatically.
    # We'll just demonstrate that we've updated the data structure. 
    updated_yaml = yaml.dump_all(documents, sort_keys=False)
    
    print("\n[Updated YAML (losing Unityâ€™s !u!/fileID tags)]:\n")
    print(updated_yaml)

if __name__ == "__main__":
    main()
